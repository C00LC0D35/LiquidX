/*
 * FDPClient Hacked Client
 * A free open source mixin-based injection hacked client for Minecraft using Minecraft Forge by LiquidBounce.
 * https://github.com/SkidderMC/FDPClient/
 */
package net.ccbluex.liquidbounce.features.module.modules.exploit

import net.ccbluex.liquidbounce.LiquidBounce
import net.ccbluex.liquidbounce.event.*
import net.ccbluex.liquidbounce.features.module.Module
import net.ccbluex.liquidbounce.features.module.ModuleCategory
import net.ccbluex.liquidbounce.features.module.ModuleInfo
import net.ccbluex.liquidbounce.features.module.modules.exploit.disablers.DisablerMode
import net.ccbluex.liquidbounce.features.value.BoolValue
import net.ccbluex.liquidbounce.features.value.IntegerValue
import net.ccbluex.liquidbounce.features.value.ListValue
import net.ccbluex.liquidbounce.utils.ClassUtils

@ModuleInfo(name = "Disabler", category = ModuleCategory.EXPLOIT)
class Disabler : Module() {
    private val modes = ClassUtils.resolvePackage("${this.javaClass.`package`.name}.disablers", DisablerMode::class.java)
        .map { it.newInstance() as DisablerMode }
        .sortedBy { it.modeName }

    private val mode: DisablerMode
        get() = modes.find { modeValue.equals(it.modeName) } ?: throw NullPointerException() // this should not happen



    private val modeValue: ListValue = object : ListValue("Mode", modes.map { it.modeName }.toTypedArray(), "MineplexCombat") {
        override fun onChange(oldValue: String, newValue: String) {
            if (state) onDisable()
        }

        override fun onChanged(oldValue: String, newValue: String) {
            if (state) onEnable()
        }
    }
    private val debugValue = BoolValue("Debug", false)

    override fun onEnable() {
        mode.onEnable()
    }

    override fun onDisable() {
        mc.timer.timerSpeed = 1F
        mode.onDisable()
    }

    @EventTarget
    fun onUpdate(event: UpdateEvent) {
        mode.onUpdate(event)
    }

    @EventTarget
    fun onMotion(event: MotionEvent) {
        mode.onMotion(event)
    }

    @EventTarget
    fun onPacket(event: PacketEvent) {
        mode.onPacket(event)
    }

    @EventTarget
    fun onMove(event: MoveEvent) {
        mode.onMove(event)
    }

    @EventTarget
    fun onBlockBB(event: BlockBBEvent) {
        mode.onBlockBB(event)
    }

    @EventTarget
    fun onJump(event: JumpEvent) {
        mode.onJump(event)
    }

    @EventTarget
    fun onStep(event: StepEvent) {
        mode.onStep(event)
    }

    @EventTarget
    fun onWorld(event: WorldEvent) {
        mode.onWorld(event)
    }

    override val tag: String
        get() = modeValue.get()

    fun debugMessage(str: String) {
        if (debugValue.get()) {
            alert("§7[§c§lDisabler§7] §b$str")
        }
    }

    @JvmField
    val keepSprint = BoolValue("KeepSprint", true)
        .displayable { mode.equals("Vulcan") }

    @JvmField
    val velocity = BoolValue("Velocity", true)
        .displayable { mode.equals("Vulcan") }

    @JvmField
    val heldItemSpoof = BoolValue("HeldItemSpoof", true)
        .displayable { mode.equals("Vulcan") }

    //Boat
    @JvmField
    val noGround = BoolValue("NoGroundPacket", true)
        .displayable { mode.equals("Boat") }

    //Verus Blatant
    val silentFlag = BoolValue("SilentFlag", true)
        .displayable { mode.equals("VerusBlatant") }

    val bufferSize: IntegerValue = IntegerValue("BufferSize", 300, 0, 1000)

    val flagDelay: IntegerValue = IntegerValue("FlagDelay", 45, 30, 60)


    val repeatTimes: IntegerValue = IntegerValue("RepeatTimes", 1, 1, 5)

    val repeatTimesFighting: IntegerValue = IntegerValue("RepeatTimesFighting", 1, 1, 5)

    //Verus Legit
    val fly4I = BoolValue("Fly4I", true)
        .displayable { mode.equals("VerusLegit") }

    val fly4C = BoolValue("Fly4C", true)
        .displayable { mode.equals("VerusLegit") }

    val timer3A = BoolValue("Timer3A", true)
        .displayable { mode.equals("VerusLegit") }

    val scaffold14E = BoolValue("Scaffold14E", true)
        .displayable { mode.equals("VerusLegit") }

    val scaffold14D = BoolValue("Scaffold14D", true)
        .displayable { mode.equals("VerusLegit") }

    val omniSprint13E = BoolValue("OmniSprint13E", true)
        .displayable { mode.equals("VerusLegit") }

    //Basic
    val c00Cancel = BoolValue("C00Cancel", false)
        .displayable { mode.equals("Basic") }

    val c0bCancel = BoolValue("C0BCancel", false)
        .displayable { mode.equals("Basic") }

    val c0fCancel = BoolValue("C0FCancel", false)
        .displayable { mode.equals("Basic") }


    //Watch 杨茗翔
    val keepAliveDisabler = BoolValue("KeepAliveDisabler", false)
        .displayable { mode.equals("WatchDog") }

    val c0BDisabler = BoolValue("C0BDisabler", false)
        .displayable { mode.equals("WatchDog") }

    val lessFlag = BoolValue("LessFlag", true)
        .displayable { mode.equals("WatchDog") }

    val noC03 = BoolValue("NoC03s", true)
        .displayable { mode.equals("WatchDog") }

    val timerDisabler = BoolValue("TimerDisabler", true)
        .displayable { mode.equals("WatchDog") }

    val strafeDisabler = BoolValue("StrafeDisabler", true)
        .displayable { mode.equals("WatchDog") }

    val strafeDisablerPackets: IntegerValue = IntegerValue("StrafeDisablerPackets", 70, 60, 120)
    open fun getModes(): Array<String>? {
        val list: MutableList<String> = ArrayList()
        return list.toTypedArray()
    }


    override val values = super.values.toMutableList().also { modes.map { mode -> mode.values.forEach { value -> it.add(value.displayable { modeValue.equals(mode.modeName) }) } } }
}
/*
 * FDPClient Hacked Client
 * A free open source mixin-based injection hacked client for Minecraft using Minecraft Forge by LiquidBounce.
 * https://github.com/SkidderMC/FDPClient/
 */
package net.ccbluex.liquidbounce.features.module.modules.exploit.disablers.other;

import net.ccbluex.liquidbounce.event.PacketEvent;
import net.ccbluex.liquidbounce.event.UpdateEvent;
import net.ccbluex.liquidbounce.features.module.modules.exploit.disablers.DisablerMode;
import net.ccbluex.liquidbounce.utils.MovementUtils;
import net.ccbluex.liquidbounce.utils.PacketUtils;
import net.minecraft.network.play.client.C03PacketPlayer;
import net.minecraft.network.play.server.S08PacketPlayerPosLook;
import net.minecraft.util.BlockPos;

public final class HeirteirAC extends DisablerMode {

    public HeirteirAC() {
        super("HeiteirAC");
    }

    @Override
    public void onUpdate(UpdateEvent event) {
        if (mc.thePlayer.ticksExisted < 120) return;
        double packetX = -Math.sin(MovementUtils.getDirectioon()) * 0;
        double packetZ = Math.cos(MovementUtils.getDirectioon()) * 0;
        mc.getNetHandler().addToSendQueue(new C03PacketPlayer.C04PacketPlayerPosition(mc.thePlayer.posX + packetX,
                mc.thePlayer.posY, mc.thePlayer.posZ + packetZ, false));
        mc.getNetHandler().addToSendQueue(new C03PacketPlayer.C04PacketPlayerPosition(
                mc.thePlayer.posX + packetX, mc.thePlayer.posY + 490, mc.thePlayer.posZ + packetZ, true
        ));
    }

    @Override
    public void onPacket(PacketEvent event) {
        if (mc.thePlayer.ticksExisted < 120) return;

        if (event.getPacket() instanceof S08PacketPlayerPosLook) {
            double x,y,z,diff;
            S08PacketPlayerPosLook packet = (S08PacketPlayerPosLook) event.getPacket();
            x = packet.getX() - mc.thePlayer.posX;
            y = packet.getY() - mc.thePlayer.posY;
            z = packet.getZ() - mc.thePlayer.posZ;
            diff = Math.sqrt(x*x + y*y + z*z);
            if (diff < 12) {
                event.cancelEvent();
                PacketUtils.sendPacketNoEvent(
                        new C03PacketPlayer.C06PacketPlayerPosLook(
                                packet.getX(),
                                packet.getY(),
                                packet.getZ(),
                                packet.getYaw(),
                                packet.getPitch(),
                                !mc.theWorld.isAirBlock(new BlockPos(packet.getX(),packet.getY()-0.1,packet.getZ()))
                        )
                );
                alerts("Packet S08 " + diff);
            }
            //alerts("Diff " + Math.sqrt(x*x+y*y+z*z));
        }
    }
}

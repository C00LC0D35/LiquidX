/*
 * FDPClient Hacked Client
 * A free open source mixin-based injection hacked client for Minecraft using Minecraft Forge by LiquidBounce.
 * https://github.com/SkidderMC/FDPClient/
 */
package net.ccbluex.liquidbounce.features.module.modules.exploit.disablers.other;

import net.ccbluex.liquidbounce.event.PacketEvent;
import net.ccbluex.liquidbounce.event.UpdateEvent;
import net.ccbluex.liquidbounce.event.WorldEvent;
import net.ccbluex.liquidbounce.features.module.modules.exploit.disablers.DisablerMode;
import net.minecraft.entity.Entity;
import net.minecraft.entity.item.EntityBoat;
import net.minecraft.network.play.client.C03PacketPlayer;

import java.util.List;

public final class Boat extends DisablerMode {

    public Boat() {
        super("Boat");
    }
    private boolean canModify = false;

    @Override
    public void onUpdate(UpdateEvent event) {
        if (mc.thePlayer.ridingEntity != null) {
            mc.thePlayer.rotationPitch = 90;
            mc.thePlayer.swingItem();
            mc.playerController.attackEntity(mc.thePlayer,mc.thePlayer.ridingEntity);
            mc.thePlayer.swingItem();
            mc.playerController.attackEntity(mc.thePlayer,getNearBoat());
            canModify = true;
        }
    }

    @Override
    public void onPacket(PacketEvent event) {
        if (mc.thePlayer.ridingEntity != null) {
            canModify = true;
        }

        if (canModify && event.getPacket() instanceof C03PacketPlayer) {
            C03PacketPlayer packet = (C03PacketPlayer) event.getPacket();
            packet.onGround = !getDisablerModule().noGround.get();
        }
    }

    @Override
    public void onWorld(WorldEvent event) {
        canModify = false;
    }

    @Override
    public void onDisable() {
        canModify = false;
    }

    @Override
    public void onEnable() {
        alerts("Place 2 Boats Next To Eachother And Right Click To Use It!");
        canModify = false;
    }

    private Entity getNearBoat() {
        List<Entity> entities = mc.theWorld.loadedEntityList;
        for (Entity entity : entities) {
            if (entity instanceof EntityBoat) {
                if (entity != mc.thePlayer.ridingEntity) {
                    return entity;
                }
            }
        }
        return null;
    }
}
